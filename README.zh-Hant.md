[English](README.md) | [日本語](README.ja.md) | [繁體中文](README.zh-Hant.md)

# Dark Traveller 24 應用程式

## 總覽

- 一個 PWA-ready 的 React/Ionic 應用程式，用於支援為期一天的線下城市定向活動。
- 參與者騎自行車在城市中尋找帶有 QR code 的檢查點。
- 掃描檢查點即可「佔領」它，並隨著時間的推移獲得分數（HP）。
- 團隊之間競爭：最先累積到目標分數的團隊獲勝。
- 參與者可以在「升級點」花費分數來提高分數的賺取速度。

技術總覽: [doc/TECHNICAL_OVERVIEW.md](doc/TECHNICAL_OVERVIEW.ja.md)
UI 總覽: [doc/UI_OVERVIEW.md](doc/UI_DESCRIPTION.ja.md)

## 開始使用（供自行託管）

此專案設計用於在 Firebase 上部署，不適合一般大眾安裝。若要執行個人實例以進行開發或私人使用：

1.  **安裝依賴套件：**
    ```bash
    yarn install
    ```
2.  **執行開發伺服器：**
    ```bash
    yarn dev
    ```
    您還需要設定自己的 Firebase 專案並將其連接到應用程式。

## 功能

- **驗證**：Firebase Authentication，僅限參與者存取。
- **即時地圖與追蹤**：Leaflet.js 地圖視圖，顯示檢查點位置、自行車路線和佔領狀態。
- **QR Code 掃描**：利用網頁瀏覽器的原生相機 API，以無縫的 PWA 體驗掃描檢查點和升級碼。
- **進度與排名**：主畫面顯示目前的目標進度 ۽ 下一個目標檢查點。排名畫面顯示團隊排名和已佔領的點。
- **個人資料與統計**：團隊個人資料頁面，包含 HP、升級等級和活動日誌。
- **檢查點保護**：被佔領的檢查點在可以被再次佔領前，會進入 5 分鐘的「冷卻」時間。

## 技術棧

此應用程式是一個客戶端繁重的 PWA，直接與 Firebase 服務對接。

```
+------------------------------------------------+
|                                                |
|      使用者的裝置（瀏覽器 / PWA）              |
|                                                |
|  +------------------------------------------+  |
|  |      React + Ionic 前端應用程式          |  |
|  |                                          |  |
|  |  - 遊戲邏輯與 UI                         |  |
|  |  - Leaflet.js 地圖                       |  |
|  |  - QR 掃描器（原生相機 API）             |  |
|  +------------------------------------------+  |
|                  |                           |
|                  | (Firebase SDK)            |
|                  v                           |
|  +------------------------------------------+  |
|  |      Firebase 服務（Google Cloud）       |  |
|  |                                          |  |
|  |  - Firestore（即時資料庫）               |  |
|  |  - 驗證                                  |  |
|  |  - 託管與儲存                            |  |
|  |  - Google Analytics                      |  |
|  +------------------------------------------+  |
|                                                |
+------------------------------------------------+
```

| 類別         | 技術 / 函式庫              | 用途                            |
| ------------ | -------------------------- | ------------------------------- |
| **核心前端** | React                      | 用於建構元件的 UI 函式庫        |
| **框架**     | Ionic                      | 用於建構跨平台 PWA 的 UI 工具組 |
| **打包工具** | Vite                       | 快速的開發伺服器和建置工具      |
| **地圖**     | Leaflet.js                 | 互動式地圖                      |
| **QR 掃描**  | `@yudiel/react-qr-scanner` | 用於相機 QR 掃描的 React 元件   |
| **後端**     | Firebase                   | 用於資料、驗證和託管的平台      |
| **資料庫**   | Firestore                  | 用於遊戲狀態的即時 NoSQL 資料庫 |
| **驗證**     | Firebase Auth              | 使用者登入和會話管理            |
| **託管**     | Firebase Hosting           | PWA 的靜態檔案託管              |
| **分析**     | Google Analytics           | 事件追蹤和使用者參與度分析      |

## 架構與資料流

1.  **客戶端邏輯**：所有遊戲規則、分數計算和資料匯總都在瀏覽器中執行。Firestore 的讀寫操作會進行批次處理，並經過最佳化以最小化網路呼叫。
2.  **Firestore 集合**：
    - **checkpoints**：每個 QR code 位置和元資料的靜態資料。
    - **users**：參與者個人資料、團隊分配、目前的 HP 和升級等級。
    - **activity_logs**：每次掃描事件（佔領/升級）的帶時間戳的記錄。
3.  **資料匯總**：客戶端從所有三個集合中提取資料，並即時計算目前的狀態。

## UI / 視圖

1.  **登入**：僅限註冊參與者使用帳戶登入。
2.  **首頁**：團隊 HP 和下一個檢查點目標的總覽。
3.  **地圖視圖**：帶有檢查點、路線覆蓋和狀態標記的互動式地圖。
4.  **QR Code 掃描**：用於掃描檢查點或升級 QR code 的相機視圖。
5.  **排名**：所有團隊及其佔領的檢查點的排行榜。
6.  **個人資料**：團隊統計資料：總 HP、升級等級、掃描歷史。

## 部署

- 託管於 **Firebase Hosting**。
- 透過 Firebase CLI 進行持續部署。
- 建置成品作為 PWA 提供，可在現代 iOS 和 Android 裝置上安裝。

## 相關專案

- **活動分析與報告**：
  https://github.com/koolerkx/dark-traveller-24-analysis
- **工作人員巡邏儀表板（網頁）**：
  https://github.com/koolerkx/dark-traveller-24-patrol
- **繁體中文 PDF 報告**：
  詳細的活動參數設計和網站分析（內部）

## 授權

MIT 授權
