[English](README.md) | [日本語](README.ja.md) | [繁體中文](README.zh-Hant.md)

# ダークトラベラー 24 アプリ

## 概要

- 1 日のオフライン都市オリエンテーリングイベントをサポートするための PWA 対応 React/Ionic アプリケーション。
- 参加者は自転車に乗って市内の QR コード付きチェックポイントを探します。
- チェックポイントをスキャンすると「キャプチャ」され、時間とともにマーク（HP）を獲得します。
- チームで競い合い、目標のマーク量を最初に蓄積したチームが勝利します。
- 参加者は「アップグレードポイント」でマークを消費して、マーク獲得速度を上げることができます。

技術概要: [doc/TECHNICAL_OVERVIEW.md](doc/TECHNICAL_OVERVIEW.ja.md)
UI 概要: [doc/UI_OVERVIEW.md](doc/UI_DESCRIPTION.ja.md)

## はじめに（セルフホスティング用）

このプロジェクトは Firebase にデプロイされるように設計されており、一般向けのインストールは意図されていません。開発または個人使用のためにパーソナルインスタンスを実行するには：

1.  **依存関係のインストール：**
    ```bash
    yarn install
    ```
2.  **開発サーバーの実行：**
    ```bash
    yarn dev
    ```
    また、独自の Firebase プロジェクトを設定し、アプリケーションに接続する必要があります。

## 特徴

- **認証**：参加者のみがアクセスできる Firebase Authentication。
- **リアルタイムマップと追跡**：チェックポイントの場所、サイクリングトラック、キャプチャステータスを表示する Leaflet.js マップビュー。
- **QR コードスキャン**：ウェブブラウザのネイティブカメラ API を利用して、シームレスな PWA エクスペリエンスでチェックポイントとアップグレードコードをスキャンします。
- **進捗とランキング**：ホーム画面に現在の目標進捗と次のターゲットチェックポイントが表示されます。ランキング画面にはチームの順位とキャプチャしたポイントが表示されます。
- **プロフィールと統計**：HP、アップグレードレベル、アクティビティログを含むチームプロフィールページ。
- **チェックポイント保護**：キャプチャされたチェックポイントは、再キャプチャされる前に 5 分間の「クールダウン」期間に入ります。

## 技術スタック

このアプリケーションは、Firebase サービスと直接連携するクライアントヘビーな PWA です。

```
+------------------------------------------------+
|                                                |
|      ユーザーのデバイス（ブラウザ/ PWA）        |
|                                                |
|  +------------------------------------------+  |
|  |      React + Ionicフロントエンドアプリ     |  |
|  |                                          |  |
|  |  - ゲームロジックとUI                    |  |
|  |  - Leaflet.jsマップ                      |  |
|  |  - QRスキャナー（ネイティブカメラAPI）   |  |
|  +------------------------------------------+  |
|                  |                           |
|                  | (Firebase SDK)            |
|                  v                           |
|  +------------------------------------------+  |
|  |      Firebaseサービス（Google Cloud）    |  |
|  |                                          |  |
|  |  - Firestore（リアルタイムデータベース） |  |
|  |  - 認証                                  |  |
|  |  - ホスティングとストレージ              |  |
|  |  - Google Analytics                      |  |
|  +------------------------------------------+  |
|                                                |
+------------------------------------------------+
```

| カテゴリ               | 技術/ライブラリ            | 目的                                                        |
| ---------------------- | -------------------------- | ----------------------------------------------------------- |
| **コアフロントエンド** | React                      | コンポーネントを構築するための UI ライブラリ                |
| **フレームワーク**     | Ionic                      | クロスプラットフォーム PWA を構築するための UI ツールキット |
| **バンドラ**           | Vite                       | 高速な開発サーバーとビルドツール                            |
| **マッピング**         | Leaflet.js                 | インタラクティブマップ                                      |
| **QR スキャン**        | `@yudiel/react-qr-scanner` | カメラベースの QR スキャン用の React コンポーネント         |
| **バックエンド**       | Firebase                   | データ、認証、ホスティングのためのプラットフォーム          |
| **データベース**       | Firestore                  | ゲーム状態のためのリアルタイム NoSQL データベース           |
| **認証**               | Firebase Auth              | ユーザーログインとセッション管理                            |
| **ホスティング**       | Firebase Hosting           | PWA の静的ファイルホスティング                              |
| **分析**               | Google Analytics           | イベント追跡とユーザーエンゲージメント分析                  |

## アーキテクチャとデータフロー

1.  **クライアントサイドロジック**：すべてのゲームルール、マーク計算、データ集計はブラウザで実行されます。Firestore の読み取り/書き込みはバッチ処理され、ネットワークコールを最小限に抑えるように最適化されています。
2.  **Firestore コレクション**：
    - **checkpoints**：各 QR コードの場所とメタデータの静的データ。
    - **users**：参加者のプロフィール、チームの割り当て、現在の HP とアップグレードレベル。
    - **activity_logs**：すべてのスキャンイベント（キャプチャ/アップグレード）のタイムスタンプ付きレコード。
3.  **データ集計**：クライアントは 3 つのコレクションすべてからプルし、リアルタイムで現在の状態を計算します。

## UI / ビュー

1.  **ログイン**：登録された参加者に制限されたアカウントログイン。
2.  **ホーム**：チームの HP と次のチェックポイントターゲットの概要。
3.  **マップビュー**：チェックポイント、トラックオーバーレイ、ステータスマーカー付きのインタラクティブマップ。
4.  **QR コードスキャン**：チェックポイントまたはアップグレード QR コードをスキャンするためのカメラビュー。
5.  **ランキング**：すべてのチームとそのキャプチャしたチェックポイントのリーダーボード。
6.  **プロフィール**：チームの統計：合計 HP、アップグレードレベル、スキャンの履歴。

## デプロイ

- **Firebase Hosting**でホストされています。
- Firebase CLI を介した継続的なデプロイ。
- ビルドアーティファクトは、最新の iOS および Android デバイスにインストール可能な PWA として提供されます。

## 関連プロジェクト

- **イベント分析とレポート**：
  https://github.com/koolerkx/dark-traveller-24-analysis
- **スタッフパトロールダッシュボード（ウェブ）**：
  https://github.com/koolerkx/dark-traveller-24-patrol
- **繁体字中国語 PDF レポート**：
  詳細なイベントパラメータ設計とウェブ分析（内部）

## ライセンス

MIT ライセンス
